# Copyright 2020-present Open Networking Foundation
# SPDX-License-Identifier: Apache-2.0

---
name: License verification

on:
  push:
    branches:
      - master
  pull_request:

jobs:
  reuse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: reuse lint
        run: make check-reuse

  fossa:
    runs-on: ubuntu-latest
    container: fossa/fossa-cli
    steps:
        - uses: actions/checkout@v2
        - name: FOSSA verification
          run: |
            echo "Run 'fossa init'"
            fossa init --no-ansi --verbose

            echo "Contents of .fossa.yml generated by 'fossa init':"
            cat .fossa.yml

            echo "Run 'fossa analyze'"
            fossa analyze --no-ansi --verbose

            echo "Get FOSSA test results with 'fossa test'"
            fossa test --no-ansi --verbose --timeout 1200

            echo "Display list of licenses detected by FOSSA using 'fossa report licenses'"
            fossa report licenses

